<!doctype html>
<html>
<head>
    <title>Socket.IO Position</title>
    <link href="css/bootstrap.min.css" rel="stylesheet" />
    <meta name="viewport" value="width=device-width;initial-scale=1" />
    <style type="text/css">
      
    </style>
</head>
<body class="" style="width:100vw; height:100vh; ">


	<!-- <input type="range" style="height:10vh; width:80vw; margin:10vw;" class="form-control" min="-1" max="1" value="0" id="position" /> -->
   

    <script src="js/lib/rx.all.min.js"></script>

    <script src="http://192.168.1.111:8080/socket.io/socket.io.js"></script>

    <script src="js/Utilities.js"></script>
	<script>
		(function() {
			var socket = io.connect('http://192.168.1.111:8080/');

            function Round(sigFig) {
                const _c = Math.pow(10, isNaN(sigFig) ? 1 : parseInt(sigFig));
                return val => Math.round(val * _c) / _c;
            }
            function ForEach(task) {
                var _task = task;
                return function (obj) {
                    for (var key in obj) {
                        obj[key] = _task(obj[key]);
                    }
                    return obj; 
                }
            }

			//var input = document.getElementById('position');
		
			//var input$ = Rx.Observable.fromEvent(input, 'input').map(function(e){
			//	return e.target.value;
			//	});

            var touch$ = Rx.Observable.fromEvent(document, 'touchmove').map(evt => { return { x: evt.changedTouches[0].pageX, y: evt.changedTouches[0].pageY }; });
            var mouse$ = Rx.Observable.fromEvent(document, 'mousemove').map(evt => { return { x: evt.clientX, y: evt.clientY }; });
                            
            var coords$ = Rx.Observable.merge(touch$, mouse$).map(function (obj) { obj.x = obj.x / window.innerWidth; obj.y = obj.y / window.innerHeight; return obj; });

            coords$.map(ForEach(Round(3))).subscribe(function (obj) { 
                document.body.innerHTML = JSON.stringify(obj);// Utilities.Bind('{ x : {{x}}, y : {{y}} }', obj);
					socket.emit('servo:move', obj);
				 });


			//input$.throttle(50).subscribe(function(val) {
			//	socket.emit('servo:move', val);
			//	});
		})();
	</script>

</body>
</html>
